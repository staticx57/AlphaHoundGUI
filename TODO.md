# TODO

## Completed âœ…
- [x] **Advanced Analysis**:
    - âœ… Use `scipy.signal.find_peaks` for automatic peak detection and labeling.
    - âœ… Isotope identification database with 100+ isotopes (Simple: 30, Advanced: 100+)
    - âœ… Decay chain detection (U-238, U-235, Th-232 series)
    - âœ… Confidence scoring with natural abundance weighting
    - âœ… **Graphical Decay Chain Visualization**: Visual flow diagrams showing parentâ†’daughterâ†’stable sequences with detected members highlighted
- [x] **Export Options**:
    - âœ… Allow exporting parsed data to JSON or CSV from the UI.
    - âœ… Generate PDF reports with spectrum plot, peaks, isotopes, and decay chains
- [x] **UI Improvements**:
    - âœ… Add zoom/pan capabilities to the chart (using `chartjs-plugin-zoom`).
    - âœ… Light/Dark mode toggle with localStorage + Nuclear/Toxic bonus themes
    - âœ… Multi-file comparison (overlay multiple spectra)
    - âœ… **Dual Isotope Detection Panel**: Side-by-side Peak Matching (Legacy) vs AI Identification (ML)
    - âœ… **Graphical Confidence Bars**: Animated progress bars with color-coded confidence levels
    - âœ… **Professional Icon System**: SVG icons replacing all emojis with consistent styling
- [x] **Data Management**:
    - âœ… Save upload history to local storage
- [x] **AlphaHound Device Integration**:
    - âœ… Serial communication with RadView Detection AlphaHoundâ„¢
    - âœ… Live dose rate monitoring via WebSocket
    - âœ… Real-time spectrum acquisition (Live Building) with timed/interruptible counts
    - âœ… Non-blocking Sidebar UI for device control
    - âœ… Integrated device control panel
    - âœ… **Device Panel Enhancement**:
        - âœ… Split layout (Controls Left / Data Right)
        - âœ… Consolidated inline controls for cleaner UI
        - âœ… Live 5-minute sparkline chart for dose rate history
- [x] **Advanced/Simple Mode Toggle**:
    - âœ… **Simple Mode** (default): Optimized thresholds (40% isotope, 30% chain) with hobby-focused library (uranium glass, mantles, radium watches, etc.)
    - âœ… **Advanced Mode**: User-adjustable confidence thresholds, energy tolerance settings, and expanded isotope library including:
        - âœ… Additional fission products (Ru-103, Zr-95, Ce-144, Mo-99, etc.)
        - âœ… Activation products (Sc-46, Cr-51, Ag-110m, Sb-124, etc.)
        - âœ… Rare earth isotopes (Eu-152/154/155, Gd-153, Tb-160, etc.)
        - âœ… Extended medical isotopes (Ga-67, In-111, Sm-153, Lu-177, etc.)
        - âœ… Nuclear reactor/waste products
        - âœ… Transuranics (Pu-238/239/240, Np-237, Am-243, Cm-244)
    - âœ… Settings panel (âš™ï¸) for threshold customization (isotope min confidence, chain min confidence, peak matching tolerance)
    - âœ… localStorage persistence across sessions
- [x] **Decay Chain Detection**:
    - âœ… Identify typical radioactive decay chains in detected spectra
    - âœ… When daughter products are detected, suggest likely parent isotopes
    - âœ… U-238 chain (Pa-234m, Th-234, Ra-226, Pb-214, Bi-214, etc.)
    - âœ… U-235 chain (Actinium series with abundance weighting)
    - âœ… Th-232 chain (Tl-208, Ac-228, Pb-212, etc.)
    - âœ… Visual display of detected chain members with confidence levels
    - âœ… Authoritative source links (NNDC, IAEA, LBNL, USGS, NRC)
    - âœ… **Graphical flow diagrams** with color-coded detection status
- [x] **Natural Abundance Weighting**:
    - âœ… Research-based isotopic abundance from LBNL/NRC
    - âœ… U-238 (99.3%) correctly ranks above U-235 (0.72%) in natural samples
    - âœ… Intermediate filtering layer between detection and thresholding
- [x] **Stability Fixes**:
    - âœ… Fix persistent serial disconnection issues (killed zombie processes, simplified serial loop).
    - âœ… Fixed real-time acquisition timer overshoot (300/300 exact)
    - âœ… Fixed PDF export Content-Disposition header for proper downloads
    - âœ… **Auto-Reconnect**: Automatically recovers WebSocket connection causing dose rate display to resume after network/server interruption.
    - âœ… **Visibility Optimization**: Pauses chart rendering when tab is hidden to reduce CPU usage.
    - âœ… **Unload Safeguards**: Prompts user before closing tab if recording is in progress.
    - âœ… **Memory Protection**: Caps comparison mode to 8 spectra to prevent browser crashes.
    - âš ï¸ **COUNT TIME (Partial)**: Fixed metadata display formatting (`replaceAll()` for proper key formatting) - **Still needs**: Backend must capture/store actual acquisition duration
- [x] **Deployment Improvements**:
    - âœ… Remove virtual environment requirement
    - âœ… Create simplified one-click launch process
    - âœ… Support running without AlphaHound device connected
    - âœ… **LAN Access**: Configured server for network access (host="0.0.0.0", port 3200)
- [x] **Refactor threshold filtering to application layer**:
    - âœ… Moved confidence threshold filtering from `isotope_database.py` to `main.py`
    - âœ… `identify_isotopes()` and `identify_decay_chains()` return ALL matches
    - âœ… Application layer applies filtering based on Simple/Advanced mode
    - âœ… Runtime threshold adjustment without modifying core detection logic
- [x] **ML Integration (PyRIID)**:
    - âœ… PyRIID 2.2.0 integration with MLPClassifier
    - âœ… Training on 90+ isotopes from IAEA/NNDC authoritative database
    - âœ… Multi-isotope mixture support (7 realistic sources):
        - âœ… UraniumGlass, ThoriumMantle, MedicalWaste, IndustrialGauge, CalibrationSource, NaturalBackground
    - âœ… `/analyze/ml-identify` API endpoint
    - âœ… Frontend "AI Identify" button with loading states
    - âœ… ~1500 training samples (1350 single + 150 mixtures)
    - âš ï¸ **Note**: Works best with real detector data (Poisson statistics); synthetic demo files may not match training patterns
- [x] **Auto-Save CSV on Acquisition**:
    - âœ… Automatically saves spectrum to CSV upon acquisition completion
   - âœ… Saves to `data/acquisitions/` directory
    - âœ… Filename format: `spectrum_YYYY-MM-DD_HH-MM-SS.csv`
    - âœ… Toast notification shows saved filename

## Future Enhancements

### Bugs\n- [x] âœ… **Missing Advanced Controls**: Settings modal now has working Simple/Advanced toggle, slider handlers, Apply/Reset buttons

### High Priority
- [x] âœ… **Application Rebranding (SpecTrek â†’ RadTrace)**:
    - [x] âœ… Bulk find/replace "SpecTrek" with "RadTrace" across all files
    - [x] âœ… Find and replace remaining emoji in UI with CSS/SVG
    - [x] âœ… Update README.md with new name
    - [x] âœ… Update page title and meta tags
- [ ] **Premium Branding Assets**:
    - [ ] Create and integrate transparent PNG logo to replace rocket.svg
    - [ ] Create and integrate transparent PNG favicon
    - [ ] Create and integrate transparent PNG upload icon
    - [ ] Create and integrate transparent PNG banner
- [ ] **COUNT TIME Fix (Complete)**:
    - [ ] Backend: Capture actual acquisition duration from timer
    - [ ] Backend: Pass duration to `count_time_minutes` in metadata
    - [x] âœ… Frontend: Display formatting fixed (`replaceAll()`)
- [x] âœ… **Mobile/Responsive UI**:
    - [x] âœ… Rework layout for phone screen widths (responsive breakpoints)
    - [x] âœ… Collapsible panels for small screens
    - [x] âœ… Touch-optimized controls for device acquisition
    - [x] âœ… Simplified navigation for mobile browsers
- [x] âœ… **Premium Icon System v2**:
    - [x] âœ… Professional SVG icons already implemented
- [x] âœ… **Blue/Purple Sci-Fi Theme**:
    - [x] âœ… Design and implement additional theme option
    - [x] âœ… Futuristic color palette with blue/purple gradients
    - [x] âœ… Glowing effects and tech-inspired UI elements
    - [x] âœ… Update theme selector to include new option
- [x] âœ… **Cyberpunk 2077 Theme**:
    - [x] âœ… Neon yellow/cyan color palette with dark backgrounds
    - [x] âœ… Glitch effects and holographic UI elements
    - [x] âœ… Pink/magenta accent colors
    - [x] âœ… Retro-futuristic typography and styling
- [x] âœ… **Theme-Aware Toast Notifications**:
    - [x] âœ… Update toast colors to match current theme (Dark/Light/Nuclear/Toxic/Sci-Fi/Cyberpunk)
    - [x] âœ… Add theme-specific styling for success/warning/info toasts
    - [x] âœ… Ensure proper contrast in all theme modes

### ML & Analysis
- [ ] **ML Improvements**:
    - [ ] Collect real detector data for ML fine-tuning
    - [ ] Implement confidence thresholding (>90% only)
    - [ ] Add hybrid filtering (suppress ML conflicts with Peak Matching HIGH confidence)
    - [ ] Update synthetic demo files to use realistic Poisson noise
    - [ ] Train on weak source scenarios (low count rates)
    - [ ] Add background-dominated mixture training

### Features
- [ ] **Custom Isotope Definitions**:
    - [ ] Allow users to add custom isotopes to the database via UI
    - [ ] Import/export custom isotope libraries
- [x] **Energy Calibration UI**:
    - âœ… Interactive peak marking for calibration
    - âœ… Linear calibration (Slope/Intercept)
- [x] **Background Subtraction**:
    - âœ… Load background spectrum and subtract from samples
    - âœ… Real-time net counts display
- [x] **UI Icon Polish**:
    - âœ… Replace all emoji icons with professional SVG/PNG assets
    - âœ… Icons needed: ğŸ“œ History, âš™ï¸ Settings, ğŸŒ“ Theme, ğŸ”Œ Device, ğŸ”„ Refresh, â–¶ï¸ Play, â¹ï¸ Stop, ğŸ“‚ Upload, ğŸ“„ PDF, ğŸ“Š Compare, ğŸ”¬ Analysis, ğŸš€ Rocket
    - âœ… Add favicon to browser tab
    - âœ… Consistent icon styling across all buttons
- [x] **ROI Analysis (Advanced Mode)**:
    - âœ… Region-of-Interest analysis with activity calculation (Bq/Î¼Ci)
    - âœ… AlphaHound AB+G detector efficiency database (CsI 48 cps/Î¼Sv/h, BGO 42 cps/Î¼Sv/h)
    - âœ… Uranium enrichment ratio analysis (Natural/Depleted/Enriched)
    - âœ… Chart ROI highlighting with orange overlay
    - [x] Isotope ROI database with NNDC/IAEA branching ratios
    

## Technical Debt
- [x] **Code Quality**:
    - [x] Add JSDoc comments for main.js and api.js functions
    - [x] Refactor `main.js` to use ES6 modules
    - [ ] Add unit tests for frontend JavaScript modules
    - [ ] Add unit tests for backend API endpoints
    - [ ] Implement TypeScript for type safety
- [x] **Input Validation**:
    - [x] Add Pydantic Field validators with type hints
    - [x] Add file size and extension validation
    - [x] Add port sanitization for device connection
    - [x] Add range checks for acquisition duration
- [ ] **Performance Optimization**:
    - [ ] Lazy load Chart.js and other heavy libraries
    - [ ] Implement WebWorkers for ML training
    - [ ] Optimize large spectrum rendering
    - [ ] Add service worker for offline capability
- [ ] **Security**:
    - [ ] Add CSRF protection
    - [ ] Implement rate limiting for API endpoints
    - [ ] Add authentication for LAN access (optional)
- [x] âœ… Refactor `main.py` to move CSV handling logic into its own module `csv_parser.py` or similar.

- [x] **v2.0 Analysis Robustness (Completed)**:
    - âœ… **Robust Upload Support**: Implemented `UPLOAD_SETTINGS` (1% confidence, 30keV tolerance) for CSV/N42 uploads.
    - âœ… **Dual-Mode Engine**: Live Acquisition uses Strict settings (30%) to filter U-235; Uploads use Robust settings.
    - âœ… **UI Fixes**: Resolved metadata text overlap with CSS `word-break`.
    - âœ… **Verified**: Confirmed correct filtering of U-235 (7% weighted) vs U-238 (53% weighted) in live data.
